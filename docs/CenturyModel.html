<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Implementation of the Century model</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body>

<table width="100%" summary="page for CenturyModel {SoilR}"><tr><td>CenturyModel {SoilR}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Implementation of the Century model</h2>

<h3>Description</h3>

<p>This function implements the Century model as described in Parton et al.
(1987).
</p>


<h3>Usage</h3>

<pre>
CenturyModel(
  t,
  ks = c(k.STR = 0.094, k.MET = 0.35, k.ACT = 0.14, k.SLW = 0.0038, k.PAS = 0.00013),
  C0 = c(0, 0, 0, 0, 0),
  In,
  LN,
  Ls,
  clay = 0.2,
  silt = 0.45,
  xi = 1,
  xi_lag = 0,
  solver = deSolve.lsoda.wrapper
)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>t</code></td>
<td>
<p>A vector containing the points in time where the solution is
sought.</p>
</td></tr>
<tr valign="top"><td><code>ks</code></td>
<td>
<p>A vector of length 5 containing the values of the decomposition
rates for the different pools. Units in per week.</p>
</td></tr>
<tr valign="top"><td><code>C0</code></td>
<td>
<p>A vector of length 5 containing the initial amount of carbon for
the 5 pools.</p>
</td></tr>
<tr valign="top"><td><code>In</code></td>
<td>
<p>A scalar or data.frame object specifying the amount of litter
inputs by time (mass per area per week).</p>
</td></tr>
<tr valign="top"><td><code>LN</code></td>
<td>
<p>A scalar representing the lignin to nitrogen ratio of the plant
residue inputs.</p>
</td></tr>
<tr valign="top"><td><code>Ls</code></td>
<td>
<p>A scalar representing the fraction of structural material that is
lignin.</p>
</td></tr>
<tr valign="top"><td><code>clay</code></td>
<td>
<p>Proportion of clay in mineral soil.</p>
</td></tr>
<tr valign="top"><td><code>silt</code></td>
<td>
<p>Proportion of silt in mineral soil.</p>
</td></tr>
<tr valign="top"><td><code>xi</code></td>
<td>
<p>A scalar, data.frame, function or anything that can be converted
to a scalar function of time <code><a href="ScalarTimeMap-class.html">ScalarTimeMap</a></code>  object
specifying the external (environmental and/or edaphic) effects on
decomposition rates.</p>
</td></tr>
<tr valign="top"><td><code>xi_lag</code></td>
<td>
<p>A time shift/delay  for the automatically 
created time dependent function xi(t)</p>
</td></tr>
<tr valign="top"><td><code>solver</code></td>
<td>
<p>A function that solves the system of ODEs. This can be
<code><a href="euler.html">euler</a></code> or <code><a href="deSolve.lsoda.wrapper.html">deSolve.lsoda.wrapper</a></code> or any other user
provided function with the same interface.</p>
</td></tr>
</table>


<h3>Details</h3>

<p>This is one of the few examples that internally make use of
the new infrastructure for flux based descriptions of models (see examples).
</p>


<h3>Value</h3>

<p>A Model Object that can be further queried
</p>


<h3>References</h3>

<p>Parton, W.J, D.S. Schimel, C.V. Cole, and D.S. Ojima. 1987.
Analysis of factors controlling soil organic matter levels in Great Plain
grasslands. Soil Science Society of America Journal 51: 1173&ndash;1179. Sierra,
C.A., M. Mueller, S.E. Trumbore. 2012. Models of soil organic matter
decomposition: the SoilR package version 1.0. Geoscientific Model
Development 5, 1045-1060.
</p>


<h3>See Also</h3>

<p><code><a href="RothCModel.html">RothCModel</a></code>. There are other
<code><a href="predefinedModels.html">predefinedModels</a></code> and also more general functions like
<code><a href="Model.html">Model</a></code>.
</p>


<h3>Examples</h3>

<pre>
test.ExtractionOfConstantLinDecompOpAndXi&lt;-function(){
    LNcorn &lt;- 0.17/0.004 # Values for corn clover reported in Parton et al. 1987
    xi_func &lt;- function(t){2+sin(t)}
    t_model1 &lt;- seq(0,5200,1) #
    lag &lt;- 1
    Ex1 &lt;- CenturyModel(
      t_model1,
			LN=0.5,
			Ls=0.1,
			In=0.1,
			xi=xi_func,
			xi_lag=lag
    )
    Ct &lt;- getC(Ex1)
    Rt &lt;- getReleaseFlux(Ex1)
    # now extract the operator (all model objects can do this)
    op &lt;- getDecompOp(Ex1)
    
    # and from the operator the matrix 
    print(getConstantCompartmentalMatrix(op))
    
    # This will (intentionally) only work for certain operators that have this
    # method which are at the moment only two classes: - "ConstLinDecompOp" -
    # "ConstLinDecompOpWithLinearScaleFactor"
    #
    # Therefore it is also questionable to make this a mehtod of the Model
    # class so that you could call it directly on Ex1 (Unless we create a
    # special model class the model does not know if the method call makes
    # sense because at the moment it works with all operators


    # you can also extract the automatically created ScalarTimeMap object
    tm &lt;- getLinearScaleFactor(op)
    print(tm)
    # from which you can get a normal function as usual
    xi_func_extracted &lt;- getFunctionDefinition(tm) 
    # Note that this incorporates a possible lag 
    # (If you want to check  plot it together with the original xi_func.)


    # You can also extract the ConstLinDecomp object (the constant part of the operator)
    clo &lt;- getConstLinDecompOp(op) #(and call the getConstantCompartmentalMatrix on this 
    # object yourself
    #From the clo object you can also extract the fluxrates 
    cintflrs_by_ind &lt;- getConstantInternalFluxRateList_by_PoolIndex(clo)
    coflrs_by_ind &lt;- getConstantOutFluxRateList_by_PoolIndex(clo)


    
    # The influxes are not part of the compartmental operator but we can get
    # them back from the model object.  
    # In the case of constant influxes this is pretty easy even if they had
    # been originally given as vectors but for all nonautonomous cases  our
    # traditional vector valued functions are unfortunate as it is more or less
    # impossible to know if some components of a vector valued function are
    # zero for all times and SoilR would have to assume the most general case
    # that all components are non zero....
    # To achieve structural transparency it is much better to have a 'vector
    # of functions', which is the reason I changed the way CenturyModel
    # defines the influxes. This will scale also to nonautonomous fluxes. It
    # will reach its limits though for nonlinear fluxes as it turns out that
    # for these the only way that preserves the full structural information is
    # to use scalar functions that do not even have vector arguments.  I have
    # not implemented this yet in 'Century' because I did not know how the
    # pools are called in Century, but it will be shown in Corrados example.
    ifls &lt;- getInFluxes(Ex1)
    cifls_by_ind&lt;-ConstantInFluxList_by_PoolIndex(ifls)

    # now we can finally plot the connections This is very much ad hoc still
    # but it shows how it has to be done. It will finally be a
    # method of a new model but this requires the model object to be ablte to
    # transform its influxes and compartmental operator to flux lists with the
    # challanges mentioned above
    internalConnections&lt;-lapply(
        cintflrs_by_ind
        ,function(flr){
            tuple(
                as.integer(flr@sourceIndex)
                ,as.integer(flr@destinationIndex)
            )
        }
    )
    outBoundConnections&lt;- lapply(
        coflrs_by_ind
        ,function(fl){ as.integer(fl@sourceIndex) }
    )
    inBoundConnections&lt;-lapply(
        cifls_by_ind
        ,function(fl){ as.integer(fl@destinationIndex) }
    )

    plotPoolGraphFromTupleLists(internalConnections,inBoundConnections,outBoundConnections)

    # You can also reindex the flux rates by PoolNames if you provide a vector
    # of poolNames where the names are almost free to choose as long as they
    # would qualify as variable names in R (which is tested). 
    # This is relevan for the other direction from PoolName to PoolIndex since for
    # nonlinear models this includes the translation of scalar function arguments
    # to vector arguments
    poolNames &lt;- c(
      "Structural_litter",
      "Metabolic_litter",
      "Active_SOM",
      "Slow_SOM",
      "Passive_SOM"
    )
    cintflrs_by_name &lt;- by_PoolName(cintflrs_by_ind,poolNames)
    coflrs_by_name &lt;- by_PoolName(coflrs_by_ind,poolNames)
    cifls_by_name&lt;-by_PoolName(cifls_by_ind,poolNames)

    internalConnections&lt;-lapply(
        cintflrs_by_name
        ,function(flr){
            tuple(
                as.character(flr@sourceName)
                ,as.character(flr@destinationName)
            )
        }
    )
    outBoundConnections&lt;- lapply(
        coflrs_by_name
        ,function(fl){ as.character(fl@sourceName) }
    )
    inBoundConnections&lt;-lapply(
        cifls_by_name
        ,function(fl){ as.character(fl@destinationName) }
    )

    plotPoolGraphFromTupleLists(internalConnections,inBoundConnections,outBoundConnections)
    
    # We could even build a model of the new kind. At the time of writing the only
    # available model class is SymbolicModel_by_poolName, which is in general nonlinear
    # nonautonomous. So we could translate our lists of constant rates and fluxes to 
    # (formal) functions of time and the statevariables as in 
    # WangThreePoolNonAutonomous_sym.R
    # Future Versions of SoilR can automate this translation.

}

test.withXiDataframe&lt;-function(){
    ## second example with data
    xi_func &lt;- function(t){2+sin(t)}
    t_data &lt;- 100:4000
    xi_df &lt;- data.frame(t=t_data,xi=xi_func(t_data))
    lag &lt;- 1
    t_model2 &lt;-  t_data 
    Ex2 &lt;- CenturyModel(
      t_model2,
			LN=0.5,
			Ls=0.1,
			In=0.1,
			xi=xi_df,
			xi_lag=lag
    )
    Ct &lt;- getC(Ex2)
    Rt &lt;- getReleaseFlux(Ex2)

}

test.oldExample&lt;-function(){
  t &lt;- seq(0,52*200,1) #200 years
  LNcorn &lt;- 0.17/0.004 # Values for corn clover reported in Parton et al. 1987
  Ex&lt;-CenturyModel(
    t,
		LN=0.5,
		Ls=0.1,
		In=0.1
  )
  Ct &lt;- getC(Ex)
  Rt &lt;- getReleaseFlux(Ex)

  matplot(
    t,
    Ct,
    type="l",
    col=1:5,
    lty=1,
    ylim=c(0,max(Ct)*2.5),
    ylab=expression(paste("Carbon stores (kg C", ha^-1,")")),
    xlab="Time (weeks)"
  )
  lines(
    t,
    rowSums(Ct),
    lwd=2
  )
  legend(
    "topright",
    c(
      "Structural litter",
      "Metabolic litter",
      "Active SOM",
      "Slow SOM",
      "Passive SOM",
      "Total Carbon"
    ),
    lty=1,
    lwd=c(rep(1,5),2),
    col=c(1:5,1),
    bty="n"
  )

  matplot(
    t,
		Rt,
		type="l",
		lty=1,
		ylim=c(0, max(Rt)*3),
		ylab="Respiration (kg C ha-1 week-1)",
		xlab="Time"
  )
  lines(
    t,
    rowSums(Rt),
    lwd=2
  )
  legend(
    "topright",
		c(
      "Structural litter",
		  "Metabolic litter",
		  "Active SOM",
      "Slow SOM",
      "Passive SOM",
      "Total Respiration"
    ),
    lty=1,
    lwd=c(rep(1,5),2),
    col=c(1:5,1),
    bty="n"
  )
}

test.user.Example&lt;-function(){
	C0 &lt;- c(1, 2, 15, 8, 3)
	time &lt;- seq(0, 1, 1/12)
	temp &lt;- c(0, -7, 2, 5, 11, 12, 16, 13, 13, 8, 4, 3, 2)
	rainfall &lt;- c(63, 12, 33, 22, 24, 80, 52, 133, 57, 76, 55, 92, 71)
	pet &lt;- c(35, 16, 48, 59, 115, 110, 139, 114, 103, 71, 47, 46, 42)
	xi &lt;- fT.Century1(temp) * fW.Century(rainfall, pet)
	xi &lt;- data.frame(time, xi=xi[1:length(time)])
	
	Century &lt;- CenturyModel(
    t = time,
		C0 = C0,
		LN = 0.5,
		Ls = 0.1,
		In = 0,
		clay = 0.1,
		silt = 0.2,
		xi = xi,
		xi_lag = 0
  )
	ct &lt;- getC(Century)
}

test.timedependentInput&lt;-function(){
	C0 &lt;- c(1, 2, 15, 8, 3)
	time &lt;- seq(0, 1, 1/12)
	temp &lt;- c(0, -7, 2, 5, 11, 12, 16, 13, 13, 8, 4, 3, 2)
	rainfall &lt;- c(63, 12, 33, 22, 24, 80, 52, 133, 57, 76, 55, 92, 71)
	pet &lt;- c(35, 16, 48, 59, 115, 110, 139, 114, 103, 71, 47, 46, 42)
	xi &lt;- fT.Century1(temp) * fW.Century(rainfall, pet)
	xi &lt;- data.frame(time, xi=xi[1:length(time)])
  ut &lt;- data.frame(time, rep(10, length.out=length(time)))
	
	Century &lt;- CenturyModel(
    t = time,
		C0 = C0,
		LN = 0.5,
		Ls = 0.1,
		In = ut,
		clay = 0.1,
		silt = 0.2,
		xi = xi,
		xi_lag = 0
  )
	ct &lt;- getC(Century)
}
</pre>

<hr /><div style="text-align: center;">[Package <em>SoilR</em> version 1.2.105 <a href="00Index.html">Index</a>]</div>
</body></html>
